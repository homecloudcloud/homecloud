"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.checkForProblematicUnflatKeys = exports.countKeys = void 0;
const messages_1 = require("../messages");
const logger_1 = require("./logger");
const validators_utils_1 = require("./validators.utils");
function countKeys(obj) {
    return Object.keys(obj).reduce((acc, curr) => ((0, validators_utils_1.isObject)(obj[curr]) ? acc + countKeys(obj[curr]) : ++acc), 0);
}
exports.countKeys = countKeys;
function checkForProblematicUnflatKeys(obj) {
    const sortedKeys = Object.keys(obj).sort();
    const problematicKeys = [];
    const lastKeyIndex = sortedKeys.length - 1;
    for (let i = 0; i < lastKeyIndex;) {
        const key = sortedKeys[i];
        const prefix = `${key}.`;
        let isChildKey = sortedKeys[++i].startsWith(prefix);
        if (isChildKey) {
            problematicKeys.push(key);
            while (isChildKey && i <= lastKeyIndex) {
                problematicKeys.push(sortedKeys[i]);
                isChildKey = i < lastKeyIndex && sortedKeys[++i].startsWith(prefix);
            }
        }
    }
    if (problematicKeys.length) {
        const logger = (0, logger_1.getLogger)();
        logger.log('\x1b[31m%s\x1b[0m', '⚠️', messages_1.messages.problematicKeysForUnflat(problematicKeys));
    }
}
exports.checkForProblematicUnflatKeys = checkForProblematicUnflatKeys;
//# sourceMappingURL=keys.utils.js.map